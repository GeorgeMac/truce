// DO NOT EDIT.
// This code was generated by Truce.
package example

import (
	"bytes"
	"context"
	"encoding/json"
	"errors"
	"fmt"
	"io"
	"io/ioutil"
	"net/http"
	"net/url"
	"time"
)

var _ = bytes.Compare
var _ = time.After

type ExampleClient struct {
	client *http.Client
	host   *url.URL
}

func NewExampleClient(host string) (*ExampleClient, error) {
	u, err := url.Parse(host)
	if err != nil {
		return nil, err
	}

	return &ExampleClient{client: http.DefaultClient, host: u}, nil
}

func (c *ExampleClient) GetPost(ctxt context.Context, id string) (Post, error) {
	return c.getPost(ctxt, id)
}

func (c *ExampleClient) getPost(ctxt context.Context, v0 string) (Post, error) {
	u, err := c.host.Parse(fmt.Sprintf("/api/v1/posts/%v", v0))
	if err != nil {
		return Post{}, err
	}

	var (
		body io.Reader
		resp *http.Response
	)

	req, err := http.NewRequest("GET", u.String(), body)
	if err != nil {
		return Post{}, err
	}

	resp, err = c.client.Do(req.WithContext(ctxt))
	if err != nil {
		return Post{}, err
	}

	defer func() {
		_, _ = io.Copy(ioutil.Discard, resp.Body)
		_ = resp.Body.Close()
	}()

	if err = checkResponse(resp); err != nil {
		return Post{}, err
	}

	var rtn Post
	err = json.NewDecoder(resp.Body).Decode(&rtn)
	return rtn, err
}

func (c *ExampleClient) GetPosts(ctxt context.Context, limit int64, since time.Time) ([]Post, error) {
	return c.getPosts(ctxt, limit, since)
}

func (c *ExampleClient) getPosts(ctxt context.Context, v0 int64, v1 time.Time) ([]Post, error) {
	u, err := c.host.Parse("/api/v1/posts")
	if err != nil {
		return nil, err
	}

	query := u.Query()
	query.Set("limit", fmt.Sprintf("%v", v0))
	query.Set("timestamp", v1.Format(time.RFC3339))
	u.RawQuery = query.Encode()

	var (
		body io.Reader
		resp *http.Response
	)

	req, err := http.NewRequest("GET", u.String(), body)
	if err != nil {
		return nil, err
	}

	resp, err = c.client.Do(req.WithContext(ctxt))
	if err != nil {
		return nil, err
	}

	defer func() {
		_, _ = io.Copy(ioutil.Discard, resp.Body)
		_ = resp.Body.Close()
	}()

	if err = checkResponse(resp); err != nil {
		return nil, err
	}

	var rtn []Post
	err = json.NewDecoder(resp.Body).Decode(&rtn)
	return rtn, err
}

func (c *ExampleClient) GetUser(ctxt context.Context, id string) (User, error) {
	return c.getUser(ctxt, id)
}

func (c *ExampleClient) getUser(ctxt context.Context, v0 string) (User, error) {
	u, err := c.host.Parse(fmt.Sprintf("/api/v1/users/%v", v0))
	if err != nil {
		return User{}, err
	}

	var (
		body io.Reader
		resp *http.Response
	)

	req, err := http.NewRequest("GET", u.String(), body)
	if err != nil {
		return User{}, err
	}

	resp, err = c.client.Do(req.WithContext(ctxt))
	if err != nil {
		return User{}, err
	}

	defer func() {
		_, _ = io.Copy(ioutil.Discard, resp.Body)
		_ = resp.Body.Close()
	}()

	if err = checkResponse(resp); err != nil {
		return User{}, err
	}

	var rtn User
	err = json.NewDecoder(resp.Body).Decode(&rtn)
	return rtn, err
}

func (c *ExampleClient) GetUsers(ctxt context.Context, limit int64, since time.Time) ([]User, error) {
	return c.getUsers(ctxt, limit, since)
}

func (c *ExampleClient) getUsers(ctxt context.Context, v0 int64, v1 time.Time) ([]User, error) {
	u, err := c.host.Parse("/api/v1/users")
	if err != nil {
		return nil, err
	}

	query := u.Query()
	query.Set("limit", fmt.Sprintf("%v", v0))
	query.Set("timestamp", v1.Format(time.RFC3339))
	u.RawQuery = query.Encode()

	var (
		body io.Reader
		resp *http.Response
	)

	req, err := http.NewRequest("GET", u.String(), body)
	if err != nil {
		return nil, err
	}

	resp, err = c.client.Do(req.WithContext(ctxt))
	if err != nil {
		return nil, err
	}

	defer func() {
		_, _ = io.Copy(ioutil.Discard, resp.Body)
		_ = resp.Body.Close()
	}()

	if err = checkResponse(resp); err != nil {
		return nil, err
	}

	var rtn []User
	err = json.NewDecoder(resp.Body).Decode(&rtn)
	return rtn, err
}

func (c *ExampleClient) NamespacedGetPost(ctxt context.Context, namespace string, id string) (Post, error) {
	return c.namespacedGetPost(ctxt, namespace, id)
}

func (c *ExampleClient) namespacedGetPost(ctxt context.Context, v0 string, v1 string) (Post, error) {
	u, err := c.host.Parse(fmt.Sprintf("/api/v1/namespace/%v/posts/%v", v0, v1))
	if err != nil {
		return Post{}, err
	}

	var (
		body io.Reader
		resp *http.Response
	)

	req, err := http.NewRequest("GET", u.String(), body)
	if err != nil {
		return Post{}, err
	}

	resp, err = c.client.Do(req.WithContext(ctxt))
	if err != nil {
		return Post{}, err
	}

	defer func() {
		_, _ = io.Copy(ioutil.Discard, resp.Body)
		_ = resp.Body.Close()
	}()

	if err = checkResponse(resp); err != nil {
		return Post{}, err
	}

	var rtn Post
	err = json.NewDecoder(resp.Body).Decode(&rtn)
	return rtn, err
}

func (c *ExampleClient) NamespacedGetUser(ctxt context.Context, namespace string, id string) (User, error) {
	return c.namespacedGetUser(ctxt, namespace, id)
}

func (c *ExampleClient) namespacedGetUser(ctxt context.Context, v0 string, v1 string) (User, error) {
	u, err := c.host.Parse(fmt.Sprintf("/api/v1/namespace/%v/users/%v", v0, v1))
	if err != nil {
		return User{}, err
	}

	var (
		body io.Reader
		resp *http.Response
	)

	req, err := http.NewRequest("GET", u.String(), body)
	if err != nil {
		return User{}, err
	}

	resp, err = c.client.Do(req.WithContext(ctxt))
	if err != nil {
		return User{}, err
	}

	defer func() {
		_, _ = io.Copy(ioutil.Discard, resp.Body)
		_ = resp.Body.Close()
	}()

	if err = checkResponse(resp); err != nil {
		return User{}, err
	}

	var rtn User
	err = json.NewDecoder(resp.Body).Decode(&rtn)
	return rtn, err
}

func (c *ExampleClient) PatchPost(ctxt context.Context, id string, post PatchPostRequest) (Post, error) {
	return c.patchPost(ctxt, id, post)
}

func (c *ExampleClient) patchPost(ctxt context.Context, v0 string, v1 PatchPostRequest) (Post, error) {
	u, err := c.host.Parse(fmt.Sprintf("/api/v1/posts/%v", v0))
	if err != nil {
		return Post{}, err
	}

	var (
		body io.Reader
		resp *http.Response
	)

	buf := &bytes.Buffer{}
	body = buf
	if err = json.NewEncoder(buf).Encode(v1); err != nil {
		return Post{}, err
	}

	req, err := http.NewRequest("PATCH", u.String(), body)
	if err != nil {
		return Post{}, err
	}

	resp, err = c.client.Do(req.WithContext(ctxt))
	if err != nil {
		return Post{}, err
	}

	defer func() {
		_, _ = io.Copy(ioutil.Discard, resp.Body)
		_ = resp.Body.Close()
	}()

	if err = checkResponse(resp); err != nil {
		return Post{}, err
	}

	var rtn Post
	err = json.NewDecoder(resp.Body).Decode(&rtn)
	return rtn, err
}

func (c *ExampleClient) PatchUser(ctxt context.Context, id string, user PatchUserRequest) (User, error) {
	return c.patchUser(ctxt, id, user)
}

func (c *ExampleClient) patchUser(ctxt context.Context, v0 string, v1 PatchUserRequest) (User, error) {
	u, err := c.host.Parse(fmt.Sprintf("/api/v1/users/%v", v0))
	if err != nil {
		return User{}, err
	}

	var (
		body io.Reader
		resp *http.Response
	)

	buf := &bytes.Buffer{}
	body = buf
	if err = json.NewEncoder(buf).Encode(v1); err != nil {
		return User{}, err
	}

	req, err := http.NewRequest("PATCH", u.String(), body)
	if err != nil {
		return User{}, err
	}

	resp, err = c.client.Do(req.WithContext(ctxt))
	if err != nil {
		return User{}, err
	}

	defer func() {
		_, _ = io.Copy(ioutil.Discard, resp.Body)
		_ = resp.Body.Close()
	}()

	if err = checkResponse(resp); err != nil {
		return User{}, err
	}

	var rtn User
	err = json.NewDecoder(resp.Body).Decode(&rtn)
	return rtn, err
}

func (c *ExampleClient) PutPost(ctxt context.Context, post PutPostRequest) (Post, error) {
	return c.putPost(ctxt, post)
}

func (c *ExampleClient) putPost(ctxt context.Context, v0 PutPostRequest) (Post, error) {
	u, err := c.host.Parse("/api/v1/posts")
	if err != nil {
		return Post{}, err
	}

	var (
		body io.Reader
		resp *http.Response
	)

	buf := &bytes.Buffer{}
	body = buf
	if err = json.NewEncoder(buf).Encode(v0); err != nil {
		return Post{}, err
	}

	req, err := http.NewRequest("PUT", u.String(), body)
	if err != nil {
		return Post{}, err
	}

	resp, err = c.client.Do(req.WithContext(ctxt))
	if err != nil {
		return Post{}, err
	}

	defer func() {
		_, _ = io.Copy(ioutil.Discard, resp.Body)
		_ = resp.Body.Close()
	}()

	if err = checkResponse(resp); err != nil {
		return Post{}, err
	}

	var rtn Post
	err = json.NewDecoder(resp.Body).Decode(&rtn)
	return rtn, err
}

func (c *ExampleClient) PutUser(ctxt context.Context, user PutUserRequest) (User, error) {
	return c.putUser(ctxt, user)
}

func (c *ExampleClient) putUser(ctxt context.Context, v0 PutUserRequest) (User, error) {
	u, err := c.host.Parse("/api/v1/users")
	if err != nil {
		return User{}, err
	}

	var (
		body io.Reader
		resp *http.Response
	)

	buf := &bytes.Buffer{}
	body = buf
	if err = json.NewEncoder(buf).Encode(v0); err != nil {
		return User{}, err
	}

	req, err := http.NewRequest("PUT", u.String(), body)
	if err != nil {
		return User{}, err
	}

	resp, err = c.client.Do(req.WithContext(ctxt))
	if err != nil {
		return User{}, err
	}

	defer func() {
		_, _ = io.Copy(ioutil.Discard, resp.Body)
		_ = resp.Body.Close()
	}()

	if err = checkResponse(resp); err != nil {
		return User{}, err
	}

	var rtn User
	err = json.NewDecoder(resp.Body).Decode(&rtn)
	return rtn, err
}

func checkResponse(resp *http.Response) error {
	switch resp.StatusCode {
	case http.StatusOK:
		return nil
	case 401:
		v := NotAuthorized{}
		if err := json.NewDecoder(resp.Body).Decode(&v); err != nil {
			return err
		}

		return v
	case 404:
		v := NotFound{}
		if err := json.NewDecoder(resp.Body).Decode(&v); err != nil {
			return err
		}

		return v
	default:
		return errors.New("unexpected status code")
	}
}
